<script>
(() => {
  // Runs after the page is loaded so elements definitely exist
  window.addEventListener("DOMContentLoaded", () => {
    console.log("[Loaded] button script running ✅");

    const yesBox = document.getElementById("yesBox");
    const noBox  = document.getElementById("noBox");
    const container = document.getElementById("container");
    const celebration = document.getElementById("celebration");

    // If these are null, your HTML IDs don’t match or the script is in the wrong page
    if (!yesBox || !noBox || !container || !celebration) {
      console.error("[Error] Missing elements:", { yesBox, noBox, container, celebration });
      alert("Script is running, but it can't find #yesBox / #noBox / #container / #celebration. Check IDs.");
      return;
    }

    const yesLines = [
      "Way try again.",
      "Oop, you were a little slow there",
      "Damn Jacob tf?",
      "Is this why ur flag football team lost the game?",
      "Okay last one",
      "SIKE",
      "Okay jk really last one promise."
    ];

    const noLines = [
      "Wait wtf?",
      "You better not be trying to hit No",
      "WHAT DO YOU MEAN YOU DOn'T WANNA HANG OUT???",
      "JACOB HUH",
      "Oh my god.",
      "No whatever it's fine",
      "I'm fine. I get it.",
      "Okay but fr tho stop playing.",
      "Green box is what u meant to hit.",
      "Fine how about this?"
    ];

    let yesIdx = 0;
    let noIdx  = 0;
    let yesArmed = false;
    let noArmed  = false;
    let done = false;

    // Desktop hover detection (real hover devices)
    const canHover = window.matchMedia && window.matchMedia("(hover: hover)").matches;

    function moveElement(el){
      const padding = 12;
      const w = el.offsetWidth || 260;
      const h = el.offsetHeight || 60;

      const maxX = Math.max(padding, window.innerWidth  - w - padding);
      const maxY = Math.max(padding, window.innerHeight - h - padding);

      const x = Math.floor(Math.random() * maxX);
      const y = Math.floor(Math.random() * maxY);

      el.style.position = "fixed";
      el.style.left = x + "px";
      el.style.top  = y + "px";
    }

    function buildCelebration(){
      celebration.innerHTML = "";
      celebration.style.display = "block";

      for (let i=0; i<20; i++){
        const b = document.createElement("div");
        b.className = "spinBox";
        b.style.left = (Math.random()*100) + "vw";
        b.style.top  = (Math.random()*100) + "vh";
        b.style.animationDuration = (600 + Math.random()*1200) + "ms";
        celebration.appendChild(b);
      }

      for (let i=0; i<26; i++){
        const c = document.createElement("div");
        c.className = "floatCircle";
        c.style.left = (Math.random()*100) + "vw";
        c.style.top  = (Math.random()*100) + "vh";
        c.style.animationDuration = (1800 + Math.random()*2200) + "ms";
        celebration.appendChild(c);
      }
    }

    function success(){
      if (done) return;
      done = true;

      buildCelebration();

      container.innerHTML = `
        <div class="successWrap">
          <p class="successText">
            WOOOHOOOO! Lmk when ur free. Btw this is how I used my study break (I'm going to crash out on anatomy lab studying).
          </p>
        </div>
      `;
    }

    // IMPORTANT: one “advance” handler per box.
    // Hover (desktop) OR tap/click (mobile) advances until armed.
    // Once armed, clicking triggers success.

    function advanceYes(e){
      if (done) return;

      // If armed, do not block clicks — let click handler succeed
      if (yesArmed) return;

      // On touch/pointerdown we prevent default so it doesn't also trigger click-advance
      if (e && e.type !== "mouseenter") {
        e.preventDefault();
        e.stopPropagation();
      }

      yesBox.textContent = yesLines[yesIdx];

      if (yesIdx === yesLines.length - 1) {
        yesArmed = true;

        // Return it to the original spot for an easy final click
        yesBox.style.position = "absolute";
        yesBox.style.left = "0px";
        yesBox.style.top  = "0px";
        yesBox.style.cursor = "pointer";
        return;
      }

      yesIdx++;
      moveElement(yesBox);
    }

    function advanceNo(e){
      if (done) return;
      if (noArmed) return;

      if (e && e.type !== "mouseenter") {
        e.preventDefault();
        e.stopPropagation();
      }

      noBox.textContent = noLines[noIdx];

      if (noIdx === noLines.length - 1) {
        noArmed = true;

        // Optional: make it green at the end
        noBox.style.background = "#1d8f3a";

        noBox.style.position = "absolute";
        noBox.style.left = "290px";
        noBox.style.top  = "0px";
        noBox.style.cursor = "pointer";
        return;
      }

      noIdx++;
      moveElement(noBox);
    }

    function yesFinalClick(){
      if (done) return;
      if (yesArmed) success();
    }

    function noFinalClick(){
      if (done) return;
      if (noArmed) success();
    }

    // ---- Event wiring ----
    // Desktop hover:
    if (canHover){
      yesBox.addEventListener("mouseenter", advanceYes);
      noBox.addEventListener("mouseenter", advanceNo);
    }

    // Mobile / tap:
    // Use pointerdown (covers touch) to “advance”
    yesBox.addEventListener("pointerdown", advanceYes);
    noBox.addEventListener("pointerdown", advanceNo);

    // Final click triggers success only when armed
    yesBox.addEventListener("click", yesFinalClick);
    noBox.addEventListener("click", noFinalClick);

    window.addEventListener("resize", () => {
      if (yesBox.style.position === "fixed") moveElement(yesBox);
      if (noBox.style.position === "fixed") moveElement(noBox);
    });

    console.log("[Ready] listeners attached ✅", { canHover });
  });
})();
</script>
